---
title: "7 面向对象（5）—— 多态"
subject: 软件设计实践
date: 2025-6-25
---
# 多态
**多态：单一记号可以表示多种类型的机制 函数重载 也是一种多态**
## 虚函数和多态
##### 定义
在类的定义中 前面有virtual关键字的成员函数就是虚函数
	virtual 只需在类定义里的函数声明写
	类外定义时不需要写virtual
	静态成员函数不能是虚函数
##### 多态的表现形式1
基类类型的指针可以指向基类 也可以指向派生类类型对象
通过基类指针调用基类和派生类的同名虚函数时
	若指针指向基类对象 则被调用的是基类的虚函数
	若指向派生类对象 则被调用的是派生类的虚函数
##### 多态的表现形式2
基类类型引用可以绑定到基类类型对象 也可以绑定到派生类类型对象
通过基类引用调用基类和派生类的同名虚函数时
	引用基类调用基类虚函数
	引用派生类调用派生类虚函数
##### 虚函数性质的传递
任何用于覆盖虚函数的派生类同名虚函数 也是虚函数
##### 普通成员函数中调用虚函数
当普通成员函数调用虚函数时也会有多态
##### 构造函数和析构函数调用虚函数
调用的是自己类中定义的函数
##### 虚函数的访问权限
虚函数的访问权限是根据指针类型来判断
即根据指针本身的类定义的public/private
## 虚析构函数
通过基类的指针删除派生类对象时通常只调用基类的析构函数
但是应先调用派生类的析构函数 然后再调用基类的析构函数
##### 解决方法：
把基类的析构函数声明为virtual
一般来说当一个类定义了虚函数 应该也把析构函数定义成虚函数
**构造函数不能作为虚函数**
## 纯虚函数与抽象类
#### 纯虚函数
**带有纯说明符 =0 的虚函数**
attached：
	说明符 
		=default 
		=delete  把函数删掉
		=0
由于=0和函数体无法同时出现 所以纯虚函数不允许类内定义
如果一个纯虚函数始终不会被调用则无需给出定义
#### 抽象类
包含纯虚函数的类叫抽象类
抽象类不能用于创建对象
抽象类只能作为基类来派生新类使用
抽象类的指针和引用可以直接指向抽象类中派生出来的类的对象
抽象类的成员函数内可以调用纯虚函数
	但在构造函数或析构函数内部不能调用
##### 抽象类的作用
如果一个类从抽象类派生而来 那么**当且仅当它实现了基类中的所有纯虚函数**才能成为非抽象类
抽象类经常作为一个一般性概念存在 它会包括若干个具体的派生类作为一般性概念的具体解释 
抽象类的纯虚函数则作为一个约束 要求其派生类必须实现这些纯虚函数的定义
**接口**
## 多态的作用
多态的实质
	父类定义共同接口 子类不同实现
	通过父类以相同的方式操作不同子类的行为
使用多态
	可以增强可扩展性
	需要增加或扩展功能时 需要改动和增加的代码较少
## 运行时类型识别(RTTI)
当派生类有独特的成员函数 如何动态调用呢
解决方案：运行时类型识别
typeid 运算符
dynamic_cast
C++只允许拥有虚函数的类使用RTTI
#### typeid 运算符
typeid(表达式)或typeid(类型)
对于相同“表达式”的类型或相同“类型” typeid运算符总是得到相同的值(即```==```为真)

previous:[[6 面向对象（4）——继承]]
next:[[8 C++泛型程序设计(1) ——模板与STL初步]]